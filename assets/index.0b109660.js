var Q=Object.defineProperty;var j=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var K=(l,t,e)=>t in l?Q(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e,W=(l,t)=>{for(var e in t||(t={}))V.call(t,e)&&K(l,e,t[e]);if(j)for(var e of j(t))X.call(t,e)&&K(l,e,t[e]);return l};import{d as _,i as Y,t as Z,c as I,w as z,a as B,o as b,b as x,u as c,n as $,e as q,f as O,g as E,h as L,F as A,r as D,j as P,k as T,l as C,m as ee,p as te,q as ae,s as G,v as le,x as ne,y as U,z as H,A as re,B as ie,C as de,D as se}from"./vendor.54a97dfb.js";const oe=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))d(n);new MutationObserver(n=>{for(const u of n)if(u.type==="childList")for(const m of u.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&d(m)}).observe(document,{childList:!0,subtree:!0});function e(n){const u={};return n.integrity&&(u.integrity=n.integrity),n.referrerpolicy&&(u.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?u.credentials="include":n.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function d(n){if(n.ep)return;n.ep=!0;const u=e(n);fetch(n.href,u)}};oe();const ue={class:"card-wrap"},ce=["onClick"],fe=(l,t,e="center")=>e==="left"?-1:e==="right"?l-t-1:Math.floor((l-t)/2)-1,he=l=>{const{data:t,parentOffset:e,parentCount:d,pageSize:n,defaultIndex:u,defaultExpandedId:m,frameSide:s}=T(l),h=I(()=>!d.value||e.value*2==d.value-1),f=I(()=>2*e.value+1+n.value-d.value),p=C(""),M=C(0),v=C(0);ee(()=>{v.value+n.value>t.value.length-1&&(v.value=Math.max(t.value.length-1-n.value,-1))});const w=a=>(a<-1?a=-1:a>t.value.length-n.value-1&&(a=t.value.length-n.value-1),a),S=(a,{count:r,length:o})=>{let i=a-o,g=2*(r-o)-i;return i<0?(i=0,g=2*(r-o)-i):g<0&&(g=0,i=2*(r-o)-g),i-g},y=()=>{let a=fe(t.value.length,n.value,s.value);isNaN(l.defaultIndex)||(a=w(u.value-Math.round(n.value/2))),v.value=a},k=()=>{h.value?M.value=0:M.value=S(f.value,{count:n.value,length:t.value.length}),p.value=m.value||""},F=I(()=>({data:t.value.map(a=>te(a,["pid","id",l.childFlagKey])),parentOffset:e.value,parentCount:d.value}));return z(F,(a,r)=>{B(a,r)||(B(a.data,r==null?void 0:r.data)||y(),k())},{immediate:!0,deep:!0}),{parentMiddle:h,parentLeft:f,expandedId:p,placeholder:M,leftIndex:v,legalLeftIndex:w}},pe=_({props:{data:{type:Array,required:!0,default:()=>[]},pageSize:{type:Number,required:!0,default:0},parentCount:{type:Number,required:!1,default:0},parentOffset:{type:Number,required:!1,default:0},defaultIndex:{type:Number,required:!1,default:NaN},steper:{type:Number,required:!1,default:NaN},defaultExpandedId:{type:String,required:!1,default:""},isTop:{type:Boolean,required:!1,default:!1},isBottom:{type:Boolean,required:!1,default:!1},childFlagKey:{type:String,required:!1,default:"childFlag"},focusId:{type:String,required:!1,default:""},frameSide:{type:String,required:!1,default:"center"}},emits:["expandedChange","change"],setup(l,{emit:t}){const e=l,d=Y("spaceConfig",{btnWidth:0,btnMargin:0,cardWidth:0,cardMargin:0}),n=d.cardWidth/2+d.cardMargin,u=Z(e,"pageSize"),m=I(()=>e.data.length>u.value),{expandedId:s,leftIndex:h,legalLeftIndex:f,parentLeft:p,parentMiddle:M,placeholder:v}=he(e),w=()=>{var g;const r=m.value?u.value:e.data.length,o=m.value?h.value:-1;let i;for(let N=0;N<=r-1;N++){const R=N+o+1;if(((g=e.data[R])==null?void 0:g.id)===s.value){if(i={target:e.data[R],count:r,index:N},m.value)return i;break}}return i?(v.value>0&&(i.index+=v.value/2),i.count+=Math.abs(v.value)/2,i):{target:null}};let S={target:null};z([h,s,v,u],()=>{const r=w();B(r,S)||(S=r,t("change",r))},{immediate:!0});const y=r=>{let o=r==="left"?-1:r==="right"?1:0;o*=isNaN(e.steper)?e.pageSize:e.steper,h.value=f(h.value+o)},k=r=>{const o=r.id!==s.value;t("expandedChange",{target:r,status:o}),e.isBottom||(s.value=o?r.id:"")},F=I(()=>m.value?e.data.slice(h.value+1,h.value+e.pageSize+1):e.data),a=I(()=>({"left-side":p.value===1,"right-side":p.value===2*u.value-1}));return(r,o)=>(b(),x("div",{class:$(["tree-row",{top:l.isTop,bottom:l.isBottom}])},[c(u)?(b(),x("div",{key:0,class:$(["tree-main",c(a)])},[c(m)?(b(),x("span",{key:0,class:$(["direction-wrap left",{disabled:c(h)<=-1}]),style:q({"min-width":`${c(d).btnWidth}px`,"margin-right":`${c(d).btnMargin}px`})},[O("i",{onMousedown:o[0]||(o[0]=E(()=>{},["prevent"])),onClick:o[1]||(o[1]=i=>y("left")),class:"direction left"},null,32)],6)):!c(M)&&c(v)>0&&l.data.length?(b(),x("span",{key:1,class:"placeholder",style:q({width:`${c(v)*n}px`})},null,4)):L("",!0),(b(!0),x(A,null,D(c(F),i=>{var g;return b(),x("div",{key:i.id,class:$(["item-wrap",{plus:c(s)===i.id&&((g=i.children)==null?void 0:g.length),focus:l.focusId&&l.focusId===i.id}]),style:q({margin:`0 ${c(d).cardMargin}px`,width:`${c(d).cardWidth}px`})},[l.isTop?L("",!0):(b(),x("div",{key:0,class:"connect-line",style:q({left:`${-c(d).cardMargin}px`,width:`calc(100% + ${c(d).cardMargin*2}px)`})},null,4)),O("div",ue,[P(r.$slots,"default",{data:i}),i[l.childFlagKey]?(b(),x("i",{key:0,onMousedown:o[2]||(o[2]=E(()=>{},["prevent"])),onClick:N=>k(i),class:$(["show-btn",{minus:c(s)===i.id,add:c(s)!==i.id}])},null,42,ce)):L("",!0)])],6)}),128)),c(m)?(b(),x("span",{key:2,class:$(["direction-wrap right",{disabled:c(h)>=l.data.length-c(u)-1}]),style:q({"min-width":`${c(d).btnWidth}px`,"margin-left":`${c(d).btnMargin}px`})},[O("i",{onMousedown:o[3]||(o[3]=E(()=>{},["prevent"])),onClick:o[4]||(o[4]=i=>y("right")),class:"direction right"},null,32)],6)):!c(M)&&c(v)<0&&l.data.length?(b(),x("span",{key:3,class:"placeholder",style:q({width:`${-c(v)*n}px`})},null,4)):L("",!0)],2)):L("",!0)],2))}});const ve={key:0,class:"tree-wrap"},J={btnWidth:12,btnMargin:18,cardMargin:10,cardWidth:170},ge=(l,t)=>{if(!t||l.id!==t&&!l.children.length)return null;const e=[{node:l,index:0,done:!1}];for(;e.length;){const n=e[e.length-1],u=e[e.length-2];if(n.node.id===t)break;n.node.children.length&&!n.done?(e.push({node:n.node.children[0],index:0,done:!1}),n.done=!0):(e.pop(),u&&u.node.children.length-1!==n.index&&e.push({node:u.node.children[n.index+1],index:n.index+1,done:!1}))}let d=e.map(n=>n.node.id).reverse();return console.log("path",d),d.length?d:null},me=(l,t,e="center")=>e==="left"?Math.floor(Math.min(l,t)/2):e==="right"?l<t?Math.floor(l/2):Math.floor(Math.min(l,t)/2+l-t):Math.floor(l/2),ye=(l,t)=>{const e=C(0);return G(()=>{const d=document.getElementById(l)||document.body;let n=0;const u=()=>{if(!d||d.offsetWidth===n)return;const m=d.offsetWidth-2*(t.btnWidth+t.btnMargin),s=t.cardWidth+t.cardMargin*2,h=Math.floor(m/s);h!==e.value&&(e.value=h),n=d.offsetWidth};u(),le(d,ne(u))}),{pageSize:e}},be=(l,t,e)=>{const{focusId:d,maxLevel:n,frameSide:u}=T(e),m=C([[l.value]]),s=C([]),h=C([]),f=ge(l.value,d.value);let p=[l.value],M=!1,v=0,w=0;for(;!M;){if(v>=p.length||w>=n.value){M=!0;continue}const y=p[v],k=d.value&&y.id===d.value,F=!y.children.length&&!k,a=y.children.length&&(f==null?void 0:f.length)&&!f.includes(y.id);if(F||a){v++;continue}y.children.length&&m.value.push(y.children),p.splice(v,1);const r=me(p.length,t.value-1,u.value);p.splice(r,0,y),s.value.push(y.children.length?y.id:""),h.value[s.value.length-1]=p.indexOf(y),p=y.children,v=0,w++,M=!y.children.length}const S=C(f?d.value:s.value[s.value.length-1]);return{expandedList:s,localFocusId:S,defaultIndex:h,levelData:m}},xe=_({props:{data:{type:Object,required:!0,default:()=>null},maxLevel:{type:Number,required:!0,default:0},rootId:{type:String,required:!0,default:""},spaceConfig:{type:Object,required:!1,default:()=>J},childFlagKey:{type:String,required:!1,default:"childFlag"},focusId:{type:String,required:!1,default:""},frameSide:{type:String,required:!1,default:"center"}},emits:["update:focusId","itemFetch","globalFetch"],setup(l,{emit:t}){const e=l,d=I(()=>{var a;return!!((a=e.data)==null?void 0:a.pid)}),n=a=>a!==e.maxLevel-1&&a,{data:u,maxLevel:m}=T(e),s=W(W({},J),e.spaceConfig);ae("spaceConfig",s);const{pageSize:h}=ye(e.rootId,s),{expandedList:f,localFocusId:p,defaultIndex:M,levelData:v}=be(u,h,e);z(p,a=>{t("update:focusId",a)},{immediate:!0});const w=C(new Array(m.value).fill([0,0],2)),S=({target:a,status:r},o)=>{p.value=a.id,f.value[o]=r&&a?a.id:"",r&&!a.children.length&&o<m.value-1&&t("itemFetch",a.id,o,i=>{a.children.splice(0,a.children.length,...i.children||[]),Object.assign(a,re(i,"children"))})},y=a=>{v.value=v.value.slice(0,a)},k=(a,r)=>{y(r),v.value[r]=a.children;let o=a.children,i,g=0;for(;!i;){if(g>=o.length||!f.value[r]){i=!0;continue}if(o[g].id!==f.value[r]){g++;continue}v.value[r+1]=o[g].children,o=o[g].children,g=0,r++}},F=(a,r)=>{a.target?r===m.value-1?t("globalFetch",a.target.id,"down"):(k(a.target,r+1),w.value[r+1]&&(w.value[r+1]=[a.count,a.index])):y(r+1)};return(a,r)=>c(u)&&c(h)?(b(),x("div",ve,[c(d)?(b(),x("div",{key:0,class:"go-top",onClick:r[0]||(r[0]=o=>a.$emit("globalFetch",c(u).id,"up"))})):L("",!0),(b(!0),x(A,null,D(c(v),(o,i)=>(b(),U(pe,{key:i,class:$({"level-center":n(i)}),onExpandedChange:g=>S(g,i),onChange:g=>F(g,i),data:o,"default-expanded-id":c(f)[i],"default-index":c(M)[i],"is-top":i===0,"parent-count":w.value[i]?w.value[i][0]:0,"parent-offset":w.value[i]?w.value[i][1]:0,"page-size":c(h),"child-flag-key":l.childFlagKey,"focus-id":c(p),"frame-side":l.frameSide},{default:H(({data:g})=>[P(a.$slots,"default",{data:g})]),_:2},1032,["class","onExpandedChange","onChange","data","default-expanded-id","default-index","is-top","parent-count","parent-offset","page-size","child-flag-key","focus-id","frame-side"]))),128))])):L("",!0)}});const we={id:"root"},Me={key:0},Ce=_({setup(l){const t=s=>{const h=Math.round(Math.random()*10+4);s.children=[];for(let f=0;f<h;f++)s.children.push({pid:s.id,id:`${s.id}-${f}`,children:[],childFlag:!!Math.round(Math.random())})},e=C(!1),d=C({id:"0",children:[],childFlag:!0});t(d.value);const n=d.value.children.find(s=>s.childFlag);n&&t(n);const u=(s,h,f)=>{const p={pid:s.replace(/-\d+$/,""),id:s,children:[],childFlag:!0};t(p),console.log(p),f(p)},m=(s,h="up")=>{e.value=!0,G(()=>{e.value=!1});let f;if(h==="up"){const p=s.replace(/-\d+$/,"");f={pid:p.includes("-")?p.replace(/-\d+$/,""):"",id:p,children:[],childFlag:!0}}else f={pid:s.replace(/-\d+$/,""),id:s,children:[],childFlag:!0};t(f),d.value=f,console.log(";;;;",f,s)};return(s,h)=>(b(),x("div",we,[e.value?(b(),x("p",Me," loading... ")):(b(),U(xe,{key:1,data:d.value,"max-level":4,"focus-id":"0-0-0","root-id":"root",onItemFetch:u,onGlobalFetch:m},{default:H(({data:f})=>[ie(de(f.id),1)]),_:1},8,["data"]))]))}});se(Ce).mount("#app");
