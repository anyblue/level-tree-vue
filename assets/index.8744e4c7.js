var J=Object.defineProperty;var R=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var j=(l,t,e)=>t in l?J(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e,_=(l,t)=>{for(var e in t||(t={}))Q.call(t,e)&&j(l,e,t[e]);if(R)for(var e of R(t))V.call(t,e)&&j(l,e,t[e]);return l};import{d as W,i as X,t as Y,c as M,w as z,a as B,o as b,b as x,u,n as $,e as q,f as O,g as L,F as K,r as A,h as D,j as E,k as S,l as Z,p as ee,m as te,q as P,s as ae,v as le,x as G,y as U,z as ne,A as re,B as ie,C as de}from"./vendor.b4ce90fa.js";const se=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))d(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const m of o.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&d(m)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function d(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}};se();const oe={class:"card-wrap"},ue=["onClick"],ce=(l,t,e="center")=>e==="left"?-1:e==="right"?l-t-1:Math.floor((l-t)/2)-1,fe=l=>{const{data:t,parentOffset:e,parentCount:d,pageSize:n,defaultIndex:o,defaultExpandedId:m,frameSide:s}=E(l),h=M(()=>!d.value||e.value*2==d.value-1),f=M(()=>2*e.value+1+n.value-d.value),p=S(""),C=S(0),v=S(0);Z(()=>{v.value+n.value>t.value.length-1&&(v.value=Math.max(t.value.length-1-n.value,-1))});const w=a=>(a<-1?a=-1:a>t.value.length-n.value-1&&(a=t.value.length-n.value-1),a),k=(a,{count:r,length:c})=>{let i=a-c,g=2*(r-c)-i;return i<0?(i=0,g=2*(r-c)-i):g<0&&(g=0,i=2*(r-c)-g),i-g},y=()=>{let a=ce(t.value.length,n.value,s.value);isNaN(l.defaultIndex)||(a=w(o.value-Math.round(n.value/2))),v.value=a},F=()=>{h.value?C.value=0:C.value=k(f.value,{count:n.value,length:t.value.length}),p.value=m.value||""},I=M(()=>({data:t.value.map(a=>ee(a,["pid","id",l.childFlagKey])),parentOffset:e.value,parentCount:d.value}));return z(I,(a,r)=>{B(a,r)||(B(a.data,r==null?void 0:r.data)||y(),F())},{immediate:!0,deep:!0}),{parentMiddle:h,parentLeft:f,expandedId:p,placeholder:C,leftIndex:v,legalLeftIndex:w}},he=W({props:{data:{type:Array,required:!0,default:()=>[]},pageSize:{type:Number,required:!0,default:0},parentCount:{type:Number,required:!1,default:0},parentOffset:{type:Number,required:!1,default:0},defaultIndex:{type:Number,required:!1,default:NaN},steper:{type:Number,required:!1,default:NaN},defaultExpandedId:{type:String,required:!1,default:""},isTop:{type:Boolean,required:!1,default:!1},isBottom:{type:Boolean,required:!1,default:!1},childFlagKey:{type:String,required:!1,default:"childFlag"},focusId:{type:String,required:!1,default:""},frameSide:{type:String,required:!1,default:"center"}},emits:["expandedChange","change"],setup(l,{emit:t}){const e=l,d=X("spaceConfig",{btnWidth:0,btnMargin:0,cardWidth:0,cardMargin:0}),n=d.cardWidth/2+d.cardMargin,o=Y(e,"pageSize"),m=M(()=>e.data.length>o.value),{expandedId:s,leftIndex:h,legalLeftIndex:f,parentLeft:p,parentMiddle:C,placeholder:v}=fe(e),w=()=>{var g;const r=m.value?o.value:e.data.length,c=m.value?h.value:-1;let i;for(let N=0;N<=r-1;N++){const T=N+c+1;if(((g=e.data[T])==null?void 0:g.id)===s.value){if(i={target:e.data[T],count:r,index:N},m.value)return i;break}}return i?(v.value>0&&(i.index+=v.value/2),i.count+=Math.abs(v.value)/2,i):{target:null}};let k={target:null};z([h,s,v,o],()=>{const r=w();B(r,k)||(k=r,t("change",r))},{immediate:!0});const y=r=>{let c=r==="left"?-1:r==="right"?1:0;c*=isNaN(e.steper)?e.pageSize:e.steper,h.value=f(h.value+c)},F=r=>{const c=r.id!==s.value;t("expandedChange",{target:r,status:c}),e.isBottom||(s.value=c?r.id:"")},I=M(()=>m.value?e.data.slice(h.value+1,h.value+e.pageSize+1):e.data),a=M(()=>({"left-side":p.value===1,"right-side":p.value===2*o.value-1}));return(r,c)=>(b(),x("div",{class:$(["tree-row",{top:l.isTop,bottom:l.isBottom}])},[u(o)?(b(),x("div",{key:0,class:$(["tree-main",u(a)])},[u(m)?(b(),x("span",{key:0,class:$(["direction-wrap left",{disabled:u(h)<=-1}]),style:q({"min-width":`${u(d).btnWidth}px`,"margin-right":`${u(d).btnMargin}px`})},[O("i",{onClick:c[0]||(c[0]=i=>y("left")),class:"direction left"})],6)):!u(C)&&u(v)>0&&l.data.length?(b(),x("span",{key:1,class:"placeholder",style:q({width:`${u(v)*n}px`})},null,4)):L("",!0),(b(!0),x(K,null,A(u(I),i=>{var g;return b(),x("div",{key:i.id,class:$(["item-wrap",{plus:u(s)===i.id&&((g=i.children)==null?void 0:g.length),focus:l.focusId&&l.focusId===i.id}]),style:q({margin:`0 ${u(d).cardMargin}px`,width:`${u(d).cardWidth}px`})},[l.isTop?L("",!0):(b(),x("div",{key:0,class:"connect-line",style:q({left:`${-u(d).cardMargin}px`,width:`calc(100% + ${u(d).cardMargin*2}px)`})},null,4)),O("div",oe,[D(r.$slots,"default",{data:i}),i[l.childFlagKey]?(b(),x("i",{key:0,onClick:N=>F(i),class:$(["show-btn",{minus:u(s)===i.id,add:u(s)!==i.id}])},null,10,ue)):L("",!0)])],6)}),128)),u(m)?(b(),x("span",{key:2,class:$(["direction-wrap right",{disabled:u(h)>=l.data.length-u(o)-1}]),style:q({"min-width":`${u(d).btnWidth}px`,"margin-left":`${u(d).btnMargin}px`})},[O("i",{onClick:c[1]||(c[1]=i=>y("right")),class:"direction right"})],6)):!u(C)&&u(v)<0&&l.data.length?(b(),x("span",{key:3,class:"placeholder",style:q({width:`${-u(v)*n}px`})},null,4)):L("",!0)],2)):L("",!0)],2))}});const pe={key:0,class:"tree-wrap"},H={btnWidth:12,btnMargin:18,cardMargin:10,cardWidth:170},ve=(l,t)=>{if(!t||l.id!==t&&!l.children.length)return null;const e=[{node:l,index:0,done:!1}];for(;e.length;){const n=e[e.length-1],o=e[e.length-2];if(n.node.id===t)break;n.node.children.length&&!n.done?(e.push({node:n.node.children[0],index:0,done:!1}),n.done=!0):(e.pop(),o&&o.node.children.length-1!==n.index&&e.push({node:o.node.children[n.index+1],index:n.index+1,done:!1}))}let d=e.map(n=>n.node.id).reverse();return console.log("path",d),d.length?d:null},ge=(l,t,e="center")=>e==="left"?Math.floor(Math.min(l,t)/2):e==="right"?l<t?Math.floor(l/2):Math.floor(Math.min(l,t)/2+l-t):Math.floor(l/2),me=(l,t)=>{const e=S(0);return P(()=>{const d=document.getElementById(l)||document.body;let n=0;const o=()=>{if(!d||d.offsetWidth===n)return;const m=d.offsetWidth-2*(t.btnWidth+t.btnMargin),s=t.cardWidth+t.cardMargin*2,h=Math.floor(m/s);h!==e.value&&(e.value=h),n=d.offsetWidth};o(),ae(d,le(o))}),{pageSize:e}},ye=(l,t,e)=>{const{focusId:d,maxLevel:n,frameSide:o}=E(e),m=S([[l.value]]),s=S([]),h=S([]),f=ve(l.value,d.value);let p=[l.value],C=!1,v=0,w=0;for(;!C;){if(v>=p.length||w>=n.value){C=!0;continue}const y=p[v],F=d.value&&y.id===d.value,I=!y.children.length&&!F,a=y.children.length&&(f==null?void 0:f.length)&&!f.includes(y.id);if(I||a){v++;continue}y.children.length&&m.value.push(y.children),p.splice(v,1);const r=ge(p.length,t.value-1,o.value);p.splice(r,0,y),s.value.push(y.children.length?y.id:""),h.value[s.value.length-1]=p.indexOf(y),p=y.children,v=0,w++,C=!y.children.length}const k=S(f?d.value:s.value[s.value.length-1]);return{expandedList:s,localFocusId:k,defaultIndex:h,levelData:m}},be=W({props:{data:{type:Object,required:!0,default:()=>null},maxLevel:{type:Number,required:!0,default:0},rootId:{type:String,required:!0,default:""},spaceConfig:{type:Object,required:!1,default:()=>H},childFlagKey:{type:String,required:!1,default:"childFlag"},focusId:{type:String,required:!1,default:""},frameSide:{type:String,required:!1,default:"center"}},emits:["update:focusId","itemFetch","globalFetch"],setup(l,{emit:t}){const e=l,d=M(()=>{var a;return!!((a=e.data)==null?void 0:a.pid)}),n=a=>a!==e.maxLevel-1&&a,{data:o,maxLevel:m}=E(e),s=_(_({},H),e.spaceConfig);te("spaceConfig",s);const{pageSize:h}=me(e.rootId,s),{expandedList:f,localFocusId:p,defaultIndex:C,levelData:v}=ye(o,h,e);z(p,a=>{t("update:focusId",a)},{immediate:!0});const w=S(new Array(m.value).fill([0,0],2)),k=({target:a,status:r},c)=>{p.value=a.id,f.value[c]=r&&a?a.id:"",r&&!a.children.length&&c<m.value-1&&t("itemFetch",a.id,c,i=>{a.children.splice(0,a.children.length,...i.children||[]),Object.assign(a,ne(i,"children"))})},y=a=>{v.value=v.value.slice(0,a)},F=(a,r)=>{y(r),v.value[r]=a.children;let c=a.children,i,g=0;for(;!i;){if(g>=c.length||!f.value[r]){i=!0;continue}if(c[g].id!==f.value[r]){g++;continue}v.value[r+1]=c[g].children,c=c[g].children,g=0,r++}},I=(a,r)=>{a.target?r===m.value-1?t("globalFetch",a.target.id,"down"):(F(a.target,r+1),w.value[r+1]&&(w.value[r+1]=[a.count,a.index])):y(r+1)};return(a,r)=>u(o)&&u(h)?(b(),x("div",pe,[u(d)?(b(),x("div",{key:0,class:"go-top",onClick:r[0]||(r[0]=c=>a.$emit("globalFetch",u(o).id,"up"))})):L("",!0),(b(!0),x(K,null,A(u(v),(c,i)=>(b(),G(he,{key:i,class:$({"level-center":n(i)}),onExpandedChange:g=>k(g,i),onChange:g=>I(g,i),data:c,"default-expanded-id":u(f)[i],"default-index":u(C)[i],"is-top":i===0,"parent-count":w.value[i]?w.value[i][0]:0,"parent-offset":w.value[i]?w.value[i][1]:0,"page-size":u(h),"child-flag-key":l.childFlagKey,"focus-id":u(p),"frame-side":l.frameSide},{default:U(({data:g})=>[D(a.$slots,"default",{data:g})]),_:2},1032,["class","onExpandedChange","onChange","data","default-expanded-id","default-index","is-top","parent-count","parent-offset","page-size","child-flag-key","focus-id","frame-side"]))),128))])):L("",!0)}});const xe={id:"root"},we={key:0},Ce=W({setup(l){const t=s=>{const h=Math.round(Math.random()*10+4);s.children=[];for(let f=0;f<h;f++)s.children.push({pid:s.id,id:`${s.id}-${f}`,children:[],childFlag:!!Math.round(Math.random())})},e=S(!1),d=S({id:"0",children:[],childFlag:!0});t(d.value);const n=d.value.children.find(s=>s.childFlag);n&&t(n);const o=(s,h,f)=>{const p={pid:s.replace(/-\d+$/,""),id:s,children:[],childFlag:!0};t(p),console.log(p),f(p)},m=(s,h="up")=>{e.value=!0,P(()=>{e.value=!1});let f;if(h==="up"){const p=s.replace(/-\d+$/,"");f={pid:p.includes("-")?p.replace(/-\d+$/,""):"",id:p,children:[],childFlag:!0}}else f={pid:s.replace(/-\d+$/,""),id:s,children:[],childFlag:!0};t(f),d.value=f,console.log(";;;;",f,s)};return(s,h)=>(b(),x("div",xe,[e.value?(b(),x("p",we," loading... ")):(b(),G(be,{key:1,data:d.value,"max-level":4,"focus-id":"0-0-0","root-id":"root",onItemFetch:o,onGlobalFetch:m},{default:U(({data:f})=>[re(ie(f.id),1)]),_:1},8,["data"]))]))}});de(Ce).mount("#app");
